<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dexter's Laboratory Game</title>
    <style>
        canvas {
            display: block;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        body {
            margin: 0;
            overflow: hidden;
        }
        #gameOverMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            color: red;
            font-family: Arial, sans-serif;
            display: none;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="gameOverMessage">Game Over!</div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size to window size
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Background image
        const backgroundImg = new Image();
        backgroundImg.src = './background.jpg'; // Your custom background image

        // Image sources for characters
        const dexterImg = new Image();
        dexterImg.src = './dexter.png'; // Sprite Dexter local

        const deeDeeImg = new Image();
        deeDeeImg.src = './deeDee.png'; // Sprite Dee Dee local

        let dexter = {
            x: 100,
            y: 100,
            width: 150, // Dexter is now 50% larger initially
            height: 150,
            speed: 5
        };

        let deeDee = {
            x: 400,
            y: 400,
            width: 100,
            height: 100,
            speed: 2.85 // Dee Dee is now 5% slower
        };

        let items = [];
        let score = 0;
        let gameOver = false;
        let gameStarted = false; // Flag to check if the game has started

        const keys = {
            ArrowUp: false,
            ArrowDown: false,
            ArrowLeft: false,
            ArrowRight: false
        };

        // Listen for mouse movement to control Dexter
        let mouseX = 0;
        let mouseY = 0;

        canvas.addEventListener('mousemove', (event) => {
            mouseX = event.clientX;
            mouseY = event.clientY;
        });

        // Start game on first click
        canvas.addEventListener('click', () => {
            if (!gameStarted) {
                gameStarted = true; // Start the game
                gameLoop(); // Start the game loop
            }
        });

        // Spawn items every 3 seconds
        function spawnItem() {
            const item = {
                x: Math.random() * (canvas.width - 50),
                y: Math.random() * (canvas.height - 50),
                radius: 25 // Radius for the circle item
            };
            items.push(item);
        }
        setInterval(spawnItem, 3000); // spawn every 3 seconds

        // Collision detection
        function checkCollision(rect1, rect2) {
            return (
                rect1.x < rect2.x + rect2.radius * 2 &&
                rect1.x + rect1.width > rect2.x &&
                rect1.y < rect2.y + rect2.radius * 2 &&
                rect1.y + rect1.height > rect2.y
            );
        }

        // Calculate distance between two points
        function getDistance(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        // Check if Dee Dee catches Dexter (only at the center of Dee Dee)
        function checkGameOver() {
            // Calculate the centers of Dexter and Dee Dee
            const dexterCenterX = dexter.x + dexter.width / 2;
            const dexterCenterY = dexter.y + dexter.height / 2;
            const deeDeeCenterX = deeDee.x + deeDee.width / 2;
            const deeDeeCenterY = deeDee.y + deeDee.height / 2;

            // Check if distance between centers is below a certain threshold (e.g., 10 pixels)
            const distance = getDistance(dexterCenterX, dexterCenterY, deeDeeCenterX, deeDeeCenterY);

            // If the distance is small enough, it triggers game over
            if (distance < 10) { // 10 pixels threshold
                gameOver = true;
                document.getElementById('gameOverMessage').style.display = 'block'; // Show game over message
            }
        }

        function update() {
            if (gameOver) return; // Stop the game if it's over

            // Move Dexter to mouse position
            dexter.x = mouseX - dexter.width / 2;
            dexter.y = mouseY - dexter.height / 2;

            // Dee Dee follows Dexter
            if (dexter.x > deeDee.x) deeDee.x += deeDee.speed;
            if (dexter.x < deeDee.x) deeDee.x -= deeDee.speed;
            if (dexter.y > deeDee.y) deeDee.y += deeDee.speed;
            if (dexter.y < deeDee.y) deeDee.y -= deeDee.speed;

            // Keep characters inside the canvas
            dexter.x = Math.max(0, Math.min(canvas.width - dexter.width, dexter.x));
            dexter.y = Math.max(0, Math.min(canvas.height - dexter.height, dexter.y));
            deeDee.x = Math.max(0, Math.min(canvas.width - deeDee.width, deeDee.x));
            deeDee.y = Math.max(0, Math.min(canvas.height - deeDee.height, deeDee.y));

            // Check for item collection
            items = items.filter((item) => {
                if (checkCollision(dexter, item)) {
                    score += 1; // Increment score by 1 for each item
                    dexter.width *= 1.05; // Increase Dexter's width by 5% for each point collected
                    dexter.height *= 1.05; // Increase Dexter's height by 5% for each point collected
                    return false; // Remove item from the array
                }
                return true;
            });

            // Check if Dee Dee catches Dexter
            checkGameOver();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas

            // Draw background image
            if (backgroundImg.complete) {
                ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height); // Draw the background
            }

            // Draw Dexter with scaling applied
            ctx.drawImage(dexterImg, dexter.x, dexter.y, dexter.width, dexter.height);

            // Draw Dee Dee
            ctx.drawImage(deeDeeImg, deeDee.x, deeDee.y, deeDee.width, deeDee.height);

            // Draw items (circles)
            items.forEach((item) => {
                ctx.beginPath();
                ctx.arc(item.x, item.y, item.radius, 0, Math.PI * 2); // Draw circle
                ctx.fillStyle = 'gold'; // Color of the item (yellow for coins)
                ctx.fill();
                ctx.closePath();
            });

            // Display score
            ctx.font = '30px Arial';
            ctx.fillStyle = 'black';
            ctx.fillText(`Score: ${score}`, 20, 40);
        }

        function gameLoop() {
            update();
            draw();
            if (gameStarted && !gameOver) requestAnimationFrame(gameLoop); // Continue game loop if not game over and game has started
        }

        // Wait for images to load before starting the game
        dexterImg.onload = () => {
            deeDeeImg.onload = () => {
                // Initial display before game start
                draw();
            };
        };
    </script>
</body>
</html>
